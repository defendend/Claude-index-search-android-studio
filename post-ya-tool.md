# ast-index в ya tool — быстрый поиск по коду для Claude Code и Cursor

Привет! Хочу рассказать про инструмент, который сильно упрощает работу с кодом в AI-ассистентах — **ast-index**.

## Что это

ast-index — нативный CLI-инструмент на Rust для структурного поиска по коду. Он индексирует проект в SQLite с FTS5 и позволяет находить классы, функции, usages, иерархии наследования и зависимости модулей за **1–10 мс** вместо секунд на grep.

Теперь доступен через `ya tool ast-index`.

## Зачем это нужно

Когда вы используете Claude Code или Cursor для работы с большим проектом, AI-ассистент тратит значительную часть контекста и времени на поиск нужного кода — grep, ripgrep, обход файлов. На проекте в 29 000 файлов один grep-запрос занимает 100–300 мс. AI делает десятки таких запросов за одну задачу.

ast-index решает эту проблему: тот же поиск класса занимает **1 мс** вместо 90 мс, поиск usages — **8 мс** вместо 90 мс, а импорты — **0.3 мс** вместо 90 мс. Это **14–260x быстрее** grep-подхода.

Но скорость — не главное. Главное — **структурный поиск**. ast-index понимает структуру кода: различает определение класса и его упоминание в строке, находит реализации интерфейса, строит дерево вызовов, анализирует зависимости модулей. AI-ассистент получает точные результаты с первого запроса вместо того, чтобы перебирать файлы вручную.

## Что поддерживается

14+ языков в одном инструменте:

- **Mobile**: Kotlin, Java, Swift, Objective-C
- **Web**: TypeScript, JavaScript (включая Vue, Svelte)
- **Backend**: Python, Go, C++, C#, Rust, Ruby, Perl
- **Schema**: Protocol Buffers, WSDL/XSD

Тип проекта определяется автоматически по маркерным файлам (`build.gradle.kts`, `Package.swift`, `Gemfile` и т.д.).

## Ключевые команды

```bash
# Универсальный поиск
ast-index search "ViewModel"

# Найти класс/интерфейс
ast-index class "Repository"

# Все usages символа
ast-index usages "UserRepository"

# Реализации интерфейса
ast-index implementations "BaseFragment"

# Иерархия наследования
ast-index hierarchy "ViewModel"

# Дерево вызовов
ast-index call-tree "fetchData"

# Зависимости модуля
ast-index deps ":feature:auth"

# Неиспользуемые зависимости
ast-index unused-deps ":app"

# Что изменилось в текущей ветке
ast-index changed --base trunk
```

## Как использовать с Claude Code

ast-index поставляется с плагином для Claude Code. После установки AI-ассистент автоматически использует ast-index вместо grep для поиска по коду. Это означает:

- **Меньше контекста** тратится на поиск — больше остаётся на решение задачи
- **Точнее результаты** — структурный поиск вместо текстового
- **Быстрее ответы** — десятки запросов выполняются за миллисекунды

Настройка:

```bash
# Проверить доступность
ya tool ast-index version

# Инициализация индекса
ya tool ast-index rebuild

# Далее Claude Code использует ast-index автоматически через плагин
```

## Как использовать с Cursor

В Cursor ast-index работает как внешний инструмент через терминал. Можно добавить в правила проекта:

```
При поиске кода используй ast-index:
- ast-index search "query" — универсальный поиск
- ast-index usages "Symbol" — поиск использований
- ast-index class "Name" — поиск классов
```

## Производительность

Замеры на проекте ~29 000 файлов, ~300 000 символов:

| Операция | ast-index | grep | Ускорение |
|----------|-----------|------|-----------|
| Поиск класса | 1 мс | 90 мс | **90x** |
| Usages | 8 мс | 90 мс | **12x** |
| Импорты файла | 0.3 мс | 90 мс | **260x** |
| Зависимости модуля | 3 мс | 90 мс | **90x** |
| Универсальный поиск | 11 мс | 280 мс | **14x** |

Бинарь весит ~4.4 МБ, без внешних зависимостей.

## Установка

```bash
# Через ya tool
ya tool ast-index rebuild

# Через Homebrew
brew tap defendend/ast-index
brew install ast-index
```
